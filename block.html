<!DOCTYPE html>
<html>
	<head>
        
        
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
		<script src='script.js'></script>
		<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">

		<link rel="stylesheet" href="style.css" />
		
	<script type="text/javascript">
  
   function change(id)
   {
      var cname=document.getElementById(id).className;
      var ab=document.getElementById(id+"_hidden").value;
      document.getElementById(cname+"rating").innerHTML=ab;

      for(var i=ab;i>=1;i--)
      {
         document.getElementById(cname+i).src="star2.png";
      }
      var id=parseInt(ab)+1;
      for(var j=id;j<=5;j++)
      {
         document.getElementById(cname+j).src="star1.png";
      }
   }

</script>	
		<title>Block Blaster</title>
		<style>
	


		body, html {
	
	font-family:sans-serif;
	background-color: #7BCFDE;
	height:90%;
	width:100%;
}

button.big_button:active {

	border-style:inset;
	background-color:#686869;
	
	}
	
button.big_button:hover {

	background-color: #e6e7eb;

	}
	

	
#header {

	font-family:sans-serif;
	text-align:center;
	font-size: 2em;
	
	
	}
	
	#footer {

	font-family:sans-serif;
	text-align:center;
	font-size: 1.25em;
	background-color:#FFAA00;
	color:#3914AF;
	-webkit-text-stroke: 1px black;
	margin:auto;
	
	
	}


#game_area {

	background-color:#ffffff;
	width:90%;
	max-width:90%;
	height:auto;
	min-height:70%;
	max-height:70%;
	margin:auto;
	border:2px solid black;
	padding:0;
	border-radius:10px;
	clear:both;
	position:relative;
	text-align:center;
	


}


.big_button {

	
	margin-right: auto;
	margin-left: auto;
	background-color:#d0d0d5;
	border-style:outset;
	border-radius:10px;
	text-shadow:#0000000;
	padding:1%;
	font-size:2em;
	margin-top:10%;

}

.block {

	height:3em;
	width:3em;
	background-color:#7BCFDE;
	top:0;
	left:0;
	position:absolute;
	padding:0;
	border:2px solid black;
	display:flex;
	

}

.block:hover{

	cursor:crosshair;
	
}
		</style>
	</head>
	<body>
	
	<script>
	$(document).ready(function() {


var AreaMaker = function (){

	this.getWidth = function() {
		var width = $('#game_area').width();
		return width;
	};
	this.getHeight = function() {
		var height = $('#game_area').height();
		return height;
	};

	this.gameWidth = this.getWidth();
	this.gameHeight = this.getHeight();
	
};

var GameMaker = function(gameArea) {

	this.level = 1;
	this.gameOver = false;
	
	this.getRandom = function(min,max) {
		var number = Math.floor(Math.random() * (max - min + 1)) + min;
		return number;
	};
	
	this.getColor = function() {
		var color = this.getRandom(1,4);
		switch(color) {
			case 1:
				color = "red";
				break;
			case 2:
				color = "green";	
				break;
			case 3:
				color = "gold";
				break;
			case 4:
				color = "blue";
				break;
		}
		return color;
	};
	
	this.setLeft = function(blockName) {
		var name = '#'+blockName;
		var gameWidth = gameArea.gameWidth;
		var blockWidth = $(name).width();
		var width = gameWidth - (blockWidth*2);
		var leftPosition = this.getRandom(1,width);
		return leftPosition;
	};
	
	this.reset = function(){
		this.level=1;
		var myClass = this;
		setTimeout(function(){
		$('.block').remove();
		},500)
		$('#game_area').append('<button id="reset" class="big_button">PLAY AGAIN</button>');
            // add event binding for new button
            $(document).on("click", '#reset', function () {
			$('#reset').effect('explode',750,function(){$('#reset').remove();});
			$('#footer').html('<h2>Level: 1</h2>'); 
			
			$('.block').remove();
			myClass.blockLauncher(myClass.level);
		});
	};
	
	this.blockName =function(number){
		name = 'block'+number;
		return name;
	};
	
	this.levelUp = function(blockName){
		$('#'+blockName).remove();
	
		if($('#game_area').children().length === 0 ) {
			this.level++;
			var level = this.level;
			$('#footer').html('<h2>Level:' +level+'</h2>');  // updates the footer with the new level
			this.blockLauncher(level);
		}
	};

	this.blockBuilder = function(name){
		var blockName = name;
		$('#game_area').prepend('<div class = "block" id=' + blockName + '></div>');
		$('body').disableSelection();
		var color = this.getColor();
		$('#'+blockName).css("background-color",color);
		
		var leftPosition = this.setLeft(blockName);
		$('#'+blockName).css("left",+leftPosition);
		
		var myClass = this;
			
		$('#'+blockName).click(function(){
			$(this).hide('drop',{pieces:16},250,function(){myClass.levelUp(blockName);});
		});
		
		this.checkStatus(blockName);
	};
	
	
			
	this.getPosition = function(blockName){
		var name = '#'+blockName;
		var position = $(name).position().top;
		return position;
	};
	
	this.checkStatus = function(blockName){
		var name = '#'+blockName;
		var gameHeight = gameArea.gameHeight;
		var position = this.getPosition(blockName);
		var blockHeight = $(name).height();
		if(position >= (gameHeight - blockHeight)) {
			$('.block').stop().fadeOut('slow');
			this.gameOver = true;
			alert('Game Over');
			this.reset();
		}else{
			this.dropIt(blockName);
		}
	};
		
	this.dropIt = function(blockName){
		var name='#'+blockName;
		var speed = 2;
		var myClass = this;
		//var check = this.checkStatus(blockName);
		$(name).animate({top:'+='+speed},10,function(){myClass.checkStatus(blockName);});
	};
	
	this.blockLauncher = function(level) {
		this.gameOver=false;
		var i = 0;
		var myClass = this;

		var launch = function () {
			
			setTimeout(function(){ // loop repeats every half second
			var blockName = myClass.blockName(i);
			$('#'+blockName).remove();
			myClass.blockBuilder(blockName); // calls the function that creates the block
			i++;
			if(i<level && myClass.gameOver==false) {
			launch();
			}
		},500)
			if(this.gameOver==true){
			$('.block').effect('drop', 750);
			}
		}; // ends launch function
		
		launch();
	

	}; // ends blockLauncher object
}; // ends gameMaker constructor


$('#start_button').click(function(){
	
	var gameArea = new AreaMaker();
	var blockBlaster = new GameMaker(gameArea);

		
		$('#start_button').effect('fold',750,function(){$('#start_button').remove();});
		$('#footer').html('<h2>Level: 1</h2>');
		
		
	blockBlaster.blockLauncher(blockBlaster.level);
	
}); // ends start button click
			
				
}); // ends document ready
	</script>
	
		<div id="header">
		<h1>BLOCK BLASTER</h1>
		</div>

			<div id="game_area">

		<button id= "start_button" class = "big_button">START</button>
	
	
		
		</div> <!--game area -->
		
		<div id = "footer">
		</div>
	<?php
    $host="localhost";
    $username="root";
    $password="";
    $databasename="sample";

    $connect=mysql_connect($host,$username,$password);
    $db=mysql_select_db($databasename);
	
    $select_rating=mysql_query("select php,asp,jsp from rating");
    $total=mysql_num_rows($select_rating);
  
    while($row=mysql_fetch_array($select_rating))
    {
	  $phpar[]=$php;
	  $aspar[]=$asp;
	  $jspar[]=$jsp;
	  
    }
    $total_php_rating=(array_sum($phpar)/$total);
    $total_asp_rating=(array_sum($aspar)/$total);
    $total_jsp_rating=(array_sum($jspar)/$total);
  
?>

<form method="post" action="insert_rating.php">
  <p id="total_votes">Total Votes:<?php echo $total;?></p>
  <div class="div">
	  <p>PHP (<?php echo $total_php_rating;?>)</p>
	  <input type="hidden" id="php1_hidden" value="1">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="php1" class="php">
	  <input type="hidden" id="php2_hidden" value="2">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="php2" class="php">
	  <input type="hidden" id="php3_hidden" value="3">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="php3" class="php">
	  <input type="hidden" id="php4_hidden" value="4">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="php4" class="php">
	  <input type="hidden" id="php5_hidden" value="5">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="php5" class="php">
  </div>

  <div class="div">
	  <p>ASP (<?php echo $total_asp_rating;?>)</p>
	  <input type="hidden" id="asp1_hidden" value="1">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="asp1" class="asp">
	  <input type="hidden" id="asp2_hidden" value="2">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="asp2" class="asp">
	  <input type="hidden" id="asp3_hidden" value="3">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="asp3" class="asp">
	  <input type="hidden" id="asp4_hidden" value="4">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="asp4" class="asp">
	  <input type="hidden" id="asp5_hidden" value="5">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="asp5" class="asp">
  </div>

  <div class="div">
  	  <p>JSP (<?php echo $total_jsp_rating;?>)</p>
	  <input type="hidden" id="jsp1_hidden" value="1">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="jsp1" class="jsp">
	  <input type="hidden" id="jsp2_hidden" value="2">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="jsp2" class="jsp">
	  <input type="hidden" id="jsp3_hidden" value="3">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="jsp3" class="jsp">
	  <input type="hidden" id="jsp4_hidden" value="4">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="jsp4" class="jsp">
	  <input type="hidden" id="jsp5_hidden" value="5">
	  <img src="images/star1.png" onmouseover="change(this.id);" id="jsp5" class="jsp">
  </div>

  <input type="hidden" name="phprating" id="phprating" value="0">
  <input type="hidden" name="asprating" id="asprating" value="0">
  <input type="hidden" name="jsprating" id="jsprating" value="0">
  <input type="submit" value="Submit" name="submit_rating">

</form> 	

	</body>
</html>
