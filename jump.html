<html>
<head>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

  <script src"//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
 
</head>

<body>
  <style>
 $card-height: 70vh;
$pic-text-rel: 40%;
$pic-margin: 5%;
$col-rel: 30%;

body{
  background: url("https://images3.alphacoders.com/273/273289.jpg") no-repeat left bottom fixed;
  background-size: cover;
}

h1 {
  padding-top: 5%;
  font-family: 'Press Start 2P';
  text-align: center;
}

.main-card {
  position: relative;
  margin-top: (100-$card-height)/2;
  height: $card-height;
  width: 60vw;
  margin-left: 20vw;
  background-color: rgba(white, 0.5);
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  
  img {
    display: inline-block;
    width: $pic-text-rel;
    max-height: 70%;
    margin: 0% $pic-margin 0% $pic-margin;
  }
  
  #table-container {
    display: inline-block;
    width: 100 - 5 - $pic-text-rel - 2*$pic-margin;
    vertical-align: top;
  }
  
  .data {
    margin-left: 10px;
  }
  
  .att {
    font-weight: bold;
  }
}

#background-progressbar{ 
  background-color: black;
  border-radius: 10px;
  width: 100%;
  margin-right: -10px;
  position: relative;
}  

#progressbar{
    background-color: orange;
    width: 0%;
    height: 20px;
    border-radius: 10px;
  }

$width-buttons: 350px;
#buttons-container{
  width: $width-buttons;
  position: absolute;
  bottom: 5%;
  left: 50%;
  margin-left: -$width-buttons/2;
}

#hp-num{
    position: absolute;
    top:0;
    right:10px;
    color: white;
}
  </style>

<div class="main-card">
  <h1> Pokemon card! </h1>
  <img id="poke-pic" class="img-responsive" src="http://i1.wp.com/nintendo-papercraft.com/wp-content/uploads/2014/04/pokeball.png?resize=512%2C376" alt="Pokemon picture">
  <div id="table-container">
    <p class="att">Name:</p>
    <p class="data">&nbsp;</p>
    <p class="att">Types:</p>
    <p class="data">&nbsp;</p>
    <p class="att">Base HP:</p>
    <div id="background-progressbar" class="data"> 
      <div id="progressbar"></div>
        <p id="hp-num"></p>
    </div> 
  </div>
  <div id="buttons-container">
    <button id="get-button" class="btn btn-warning disabled" type="button">
      Get random Pokemon!
    </button>
    <button id="evolve" class="btn btn-warning disabled" target="_blank">
      Evolve!
    </button>
    <a href="" id="tweet" class="btn btn-warning" target="_blank">
      <i class="fa fa-twitter" aria-hidden="true"></i> Tweet it!
    </a>
  </div>
</div>

  <script>
 var PokeJs = (function () {
    var numPokemon;
    var baseUrl = "http://pokeapi.co";
    var baseApiUrl = baseUrl + "/api/v1";
    var pokemonUrl = baseApiUrl + "/pokemon";

    var name, types, hpNum, hpOver255, evoId, evoUrl;
    
    var _getRandomInt = function (min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    
    var _buildTweetUrl = function () {
        var twitterBaseUrl = "https://twitter.com/intent/tweet?";
        var message = "Get your random pokemon card here!";
        var this_url = window.location.href;
        var query_string = "text="+encodeURIComponent(message)+"&"+
            "url="+encodeURIComponent(this_url);
        $("#tweet").attr("href",twitterBaseUrl + query_string);
    };

    var _getTotalPokemon = function () {
        $.ajax({
            type: "GET",
            url: pokemonUrl,
            dataType: "jsonp"
        }).done(function (pokemonData) {
            numPokemon = pokemonData.meta.total_count;
            $("#get-button").removeClass("disabled");
        });
    };

    var _getPokemon = function (pokeId) {  
        var gettingPokeSprite = 
            $.ajax({
                type: "GET",
                url: baseApiUrl + "/sprite/" + pokeId,
                dataType: "jsonp"
            });
        var gettingPokeInfo = 
            $.ajax({
                type: "GET",
                url: pokemonUrl + "/" + pokeId,
                dataType: "jsonp"
            });
        // Auxiliar deferred objects to make sure the DOM is updated once both ajax are reoslved
        var deferredGettingPokeSprite = $.Deferred();
        var deferredGettingPokeInfo = $.Deferred();

        var sprite;
        gettingPokeSprite.then(
            function (pokeSpriteData) {
                sprite = baseUrl + pokeSpriteData.image;
            },
            function () {
                sprite = "http://i1.wp.com/nintendo-papercraft.com/wp-content/uploads/2014/04/pokeball.png?resize=512%2C376";
            }
        );
        gettingPokeSprite.complete(function () {
            deferredGettingPokeSprite.resolve();
        });
        
        name = "";
        types = "";
        hpNum = "0";
        hpOver255 = "0%";
        evoUrl = "";
        gettingPokeInfo.done(function (pokeInfoData) {
                name = pokeInfoData.name;
                types = $.map(pokeInfoData.types, function(val) {
                    return val.name;
                    }).join(', ');
                hpNum = pokeInfoData.hp.toString();
                hpOver255 = (pokeInfoData.hp / 255 * 100).toString() + "%";
                if (pokeInfoData.evolutions.length > 0){
                    evoUrl = pokeInfoData.evolutions[0].resource_uri;
                };
        });
        gettingPokeInfo.complete(function () {
            deferredGettingPokeInfo.resolve();
        });
                                 
        // Update DOM with the results
        $.when(deferredGettingPokeSprite, deferredGettingPokeInfo).done(function () {
                $("#poke-pic").attr('src', sprite);
                $("p:contains('Name') + p").html(name);
                $("p:contains('Types') + p").html(types);
                $("#progressbar").width(hpOver255);
                $("#hp-num").html(hpNum + "/" + "255");
                if (evoUrl != "") {
                    evoUrlArr = evoUrl.split("/");
                    evoId = evoUrlArr[evoUrlArr.length-2];
                    $("#evolve").removeClass("disabled");
                } else {
                    $("#evolve").addClass("disabled");
                };
        });
    };
    return {
        init: function () {
            _buildTweetUrl();
            _getTotalPokemon();
            $("#get-button").click(function () {
                var randomPokeId = _getRandomInt(1, numPokemon).toString();
                _getPokemon(randomPokeId);
            });
            $("#evolve").click(function () {
                _getPokemon(evoId);
            });
        },
    };

})();

$(document).ready(function() {
    PokeJs.init();
});



</script>
</body>
</html>
